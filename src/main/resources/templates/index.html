<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="zh-CN" dir="ltr" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="shortcut icon" th:href="@{/images/titleimg.jpg}" type="image/x-icon">
    <title>享出海问卷调查</title>

    <link th:href="@{css/app.31d95eba.css}" rel="stylesheet">
    <link th:href="@{css/chunk-2b82f2e7.d5b819d1.css}" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
</head>

<body class="dark-layout">
    <div id="app" class="h-100">
        <div>
            <div class="auth-wrapper auth-v2">
                <div class="row auth-inner m-0">
                   
                    <div class="d-none d-lg-flex align-items-center p-5 col-lg-8">
                        <div class="w-100 d-lg-flex align-items-center justify-content-center px-5">
                            <img src="images/login-v2-dark.58db2eaf.svg" alt="登录V2" class="img-fluid"></div>
                    </div>
                    <div class="d-flex align-items-center auth-bg px-2 p-lg-5 col-lg-4">
                        <div class="px-xl-2 mx-auto col-sm-8 col-md-6 col-lg-12">
                            <h2 class="card-title mb-1 font-weight-bold">欢迎登入
                            </h2>
                            <p class="card-text mb-2">请登录您的帐户</p>

                            <span>
                                <form class="auth-login-form mt-2">
                                    <div role="group" class="form-group" id="__BVID__50"><label for="login-username" class="d-block" id="__BVID__50__BV_label_">用户名</label>
                                        <div><span><input id="login-username" name="username" type="text"
                                                    placeholder="eleui@163.com" class="form-control"><small
                                                    class="text-danger"></small></span>
       
                                        </div>
                                    </div>
                                    <fieldset class="form-group" id="__BVID__53">
                        
                                        <div>
                                            <div class="d-flex justify-content-between"><label for="login-password">密码</label><a
                                                    href="#"
                                                    class="" target="_self"><small>忘记密码？</small></a></div>
													<span>
                                                <div role="group" class="input-group input-group-merge">
                                                    <input id="login-password" name="password"
                                                        type="password" placeholder="密码"
                                                        class="form-control-merge form-control">
                                                    <div class="input-group-append">
                                                        <div class="input-group-text"><svg
                                                                xmlns="http://www.w3.org/2000/svg" width="14px"
                                                                height="14px" viewBox="0 0 24 24" fill="none"
                                                                stroke="currentColor" stroke-width="2"
                                                                stroke-linecap="round" stroke-linejoin="round"
                                                                class="cursor-pointer feather feather-eye">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z">
                                                                </path>
                                                                <circle cx="12" cy="12" r="3"></circle>
                                                            </svg></div>
                                                    </div>
                                                    <!---->
                                                </div><small class="text-danger"></small>
                                            </span>
                                            <!---->
                                            <!---->
                                            <!---->
                                        </div>
                                    </fieldset>
											
                                    <fieldset class="form-group" id="__BVID__58">
                                        <!---->
                                        <div>
                                            <div class="custom-control custom-checkbox">
												<input id="remember-me"
                                                    type="checkbox" name="checkbox-1" class="custom-control-input"
                                                    value="true">
													<label for="remember-me" class="custom-control-label"> 记住账号 </label></div>
                                            <!---->
                                            <!---->
                                            <!---->
                                        </div>
                                    </fieldset>
									<div id="v_container" style="width: 150px;height: 40px;"></div>
									<input type="text" id="code_input" value="" name="login-email" class="form-control" placeholder="请输入验证码"/>
								
									<button id="my_button" type="button" class="btn btn-primary btn-block" ><span class="btn btn-primary btn-block" id="login_btn_line">登入</span></button>
									
									<!-- <button type="submit" class="btn btn-primary btn-block"><a href="logoutdemo.html" target="_top" class="btn btn-primary btn-block">登入</a></button> -->
                                </form>
                            </span>
                            <p class="card-text text-center mt-2"><span>没有自己的账号吗？</span><a href="#" class=""
                                    target="_self"><span>创建一个帐户</span></a></p>
                            <div class="divider my-2">
                                <div class="divider-text">或者 </div>
                            </div>
                            <div class="auth-footer-btn d-flex justify-content-center">
                                <a href="javascript:void(0)" target="_self" class="btn btn-facebook"><img src="images/qq.png"></a>
                                <a href="javascript:void(0)" target="_self" class="btn btn-twitter"><img src="images/wx.png"></a>
                                <a href="javascript:void(0)" target="_self" class="btn btn-google"><img src="images/xl.png"></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>
    

</body>
 <script th:src="@{/js/gVerify.js}"></script>
 <script th:src="@{/utils/jquery-1.12.4.js}"></script>

<script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
 <script >

     var verifyCode = new GVerify("v_container");
     document.getElementById("my_button").onclick = clicklogin;
     document.getElementById("login-password").onkeyup = login;
     document.getElementById("code_input").onkeyup = login;
     function clicklogin(){
         let username = $("#login-username").val();
         let password = $("#login-password").val();

         if (username==undefined || username == ""){
             alert("用户名不能为空！");
             $("#login-username").focus();
             return false;
         }
         if (password==undefined || password == ""){
             alert("密码不能为空！");
             $("#login-password").focus();
             return false;
         }

         var res = verifyCode.validate(document.getElementById("code_input").value);
         if(res){
             // alert("验证正确");

             $.ajax({
                 url:"/api/user/login",
                 type:"post",
                 data: {username:username,password:password},
                 dataType:"json",
                 beforeSend(){
                     NProgress.start();
                     $("#login_btn_line").html("登入中...")
                 },
                 success:function (res){
                     NProgress.done();
                     // console.log(res)
                     if(res.code==0){
                         window.localStorage.setItem("token",res.result.token);
                         window.localStorage.setItem("tokenTime",res.result.expireTime);
                         window.location.href="/main?token="+res.result.token;
                         // var html = "<form action='/main' method='post' name='testform' style='display:none'>"
                         //     + "<input type='hidden' name='token' value="+res.result.token+">"
                         //     + "</form>";
                         // document.write(html);
                         // document.testform.submit();
                         // document.testform.refresh();
                     }else{
                         $("#login_btn_line").html("登录")
                         alert(res.msg);
                     }
                 }
             })
         }else{
             alert("验证码错误");

             return false;
         }
     }
     function login(event){
         if(event.which != 13){
             return false;
         }
         clicklogin();
     }
 </script>

</html>